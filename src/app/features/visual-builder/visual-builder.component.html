<!-- src/app/features/visual-builder/visual-builder.component.html -->

<div 
  class="visual-builder"
  (keydown)="onKeyDown($event)"
  tabindex="0"
>
  
  <!-- ===== TOOLBAR ===== -->
  <header class="builder-header">
    <app-builder-toolbar></app-builder-toolbar>
  </header>
  
  <!-- ===== MAIN CONTENT ===== -->
  <div class="builder-main">
    
    <!-- ===== LEFT SIDEBAR: Component Palette ===== -->
    <aside class="builder-sidebar left">
      <app-component-palette
        (componentClick)="onComponentClick($event)"
      ></app-component-palette>
    </aside>
    
    <!-- ===== CENTER: Canvas ===== -->
    <main class="builder-canvas-container">
      <app-builder-canvas
        [components]="components()"
        [selectedComponentId]="selectedComponent()?.id || null"
        (componentSelected)="onComponentSelected($event)"
        (componentsSelected)="onComponentsSelected($event)"
        (componentsDeleted)="onComponentsDeleted($event)"
        (componentDropped)="onComponentDropped($event)"
      ></app-builder-canvas>
    </main>
    
    <!-- ===== RIGHT SIDEBAR: Tabs ===== -->
    <aside class="builder-sidebar right">
      
      <!-- Tabs Header -->
      <div class="sidebar-tabs">
        <button 
          class="tab-button"
          [class.active]="activeRightPanel() === 'layers'"
          (click)="switchRightPanel('layers')"
          title="HiÃ©rarchie des composants"
        >
          ğŸ“‹ Layers
        </button>
        <button 
          class="tab-button"
          [class.active]="activeRightPanel() === 'properties'"
          (click)="switchRightPanel('properties')"
          title="PropriÃ©tÃ©s du composant"
        >
          âš™ï¸ Properties
        </button>
      </div>
      
      <!-- Tabs Content -->
      <div class="sidebar-content">
        
        <!-- Layers Panel -->
        @if (activeRightPanel() === 'layers') {
          <app-layers-panel></app-layers-panel>
        }
        
        <!-- Properties Panel -->
        @if (activeRightPanel() === 'properties') {
          
          <!-- ğŸ†• Cas sÃ©lection multiple -->
          @if (hasMultipleSelection()) {
            <div class="multi-selection-properties">
              <div class="properties-header">
                <h3>SÃ©lection multiple</h3>
                <span class="selection-count">
                  {{ selectedComponents().length }} composants
                </span>
              </div>
              
              <div class="properties-content">
                <div class="info-box">
                  <p>ğŸ’¡ Les modifications seront appliquÃ©es Ã  tous les composants sÃ©lectionnÃ©s</p>
                </div>
                
                <!-- Liste des composants sÃ©lectionnÃ©s -->
                <div class="selected-list">
                  <h4>Composants sÃ©lectionnÃ©s :</h4>
                  <ul>
                    @for (comp of selectedComponents(); track comp.id) {
                      <li>
                        <span class="comp-icon">
                          {{ comp.type === 'button' ? 'ğŸ”˜' : 
                             comp.type === 'heading' ? 'ğŸ”¤' :
                             comp.type === 'image' ? 'ğŸ–¼ï¸' :
                             comp.type === 'input' ? 'âœï¸' : 'ğŸ“¦' }}
                        </span>
                        <span class="comp-name">{{ comp.displayName }}</span>
                        <span class="comp-type">{{ comp.type }}</span>
                      </li>
                    }
                  </ul>
                </div>
                
                <!-- PropriÃ©tÃ©s communes -->
                <div class="common-properties">
                  <h4>PropriÃ©tÃ©s communes</h4>
                  <p class="coming-soon">ğŸš§ Ã‰dition groupÃ©e disponible prochainement</p>
                  
                  <!-- Exemple de propriÃ©tÃ©s communes (dÃ©sactivÃ©es pour l'instant) -->
                  <div class="property-group disabled">
                    <label>OpacitÃ©</label>
                    <input type="range" min="0" max="100" value="100" disabled>
                  </div>
                  
                  <div class="property-group disabled">
                    <label>Marge</label>
                    <input type="text" placeholder="0px" disabled>
                  </div>
                  
                  <div class="property-group disabled">
                    <label>Padding</label>
                    <input type="text" placeholder="0px" disabled>
                  </div>
                </div>
                
                <!-- Actions groupÃ©es -->
                <div class="group-actions">
                  <h4>Actions groupÃ©es</h4>
                  <div class="actions-grid">
                    <button 
                      class="action-btn"
                      (click)="onComponentsDuplicated(selectedComponentIds())"
                      title="Dupliquer la sÃ©lection">
                      ğŸ“‹ Dupliquer
                    </button>
                    
                    <button 
                      class="action-btn"
                      (click)="onComponentsGrouped(selectedComponentIds())"
                      title="Grouper les composants">
                      ğŸ“¦ Grouper
                    </button>
                    
                    <button 
                      class="action-btn"
                      (click)="onComponentsLockToggled({ 
                        ids: selectedComponentIds(), 
                        locked: true 
                      })"
                      title="Verrouiller">
                      ğŸ”’ Verrouiller
                    </button>
                    
                    <button 
                      class="action-btn danger"
                      (click)="onComponentsDeleted(selectedComponentIds())"
                      title="Supprimer la sÃ©lection">
                      ğŸ—‘ï¸ Supprimer
                    </button>
                  </div>
                </div>
              </div>
            </div>
          }
          
          <!-- ğŸ”„ Cas sÃ©lection simple (existant) -->
          @else {
            <app-properties-panel
              [selectedComponent]="selectedComponent()"
              [visible]="true"
              (propertyChanged)="onPropertyChanged($event)"
              (closed)="onPropertiesPanelClosed()"
            ></app-properties-panel>
          }
        }
        
      </div>
      
    </aside>
    
  </div>
  
  <!-- ===== STATUS BAR ===== -->
  <footer class="builder-footer">
    <div class="status-info">
      <span class="status-item">
        ğŸ“¦ {{ componentCount() }} composant{{ componentCount() > 1 ? 's' : '' }}
      </span>
      
      <!-- ğŸ†• Affichage de la sÃ©lection -->
      @if (hasMultipleSelection()) {
        <span class="status-item highlight">
          ğŸ“Š {{ selectedComponents().length }} sÃ©lectionnÃ©(s)
        </span>
      } @else if (selectedComponent()) {
        <span class="status-item">
          ğŸ“Œ {{ selectedComponent()?.displayName }}
        </span>
      }
    </div>
    
    <!-- ğŸ†• Actions rapides pour sÃ©lection multiple -->
    @if (hasMultipleSelection()) {
      <div class="quick-actions">
        <button 
          class="quick-btn"
          (click)="onComponentsDuplicated(selectedComponentIds())"
          title="Dupliquer la sÃ©lection (Ctrl+D)">
          ğŸ“‹ Dupliquer
        </button>
        
        <button 
          class="quick-btn"
          (click)="onComponentsGrouped(selectedComponentIds())"
          title="Grouper (Ctrl+G)">
          ğŸ“¦ Grouper
        </button>
        
        <button 
          class="quick-btn"
          (click)="onComponentsLockToggled({ 
            ids: selectedComponentIds(), 
            locked: true 
          })"
          title="Verrouiller">
          ğŸ”’ Verrouiller
        </button>
      </div>
    }
  </footer>
  
</div>