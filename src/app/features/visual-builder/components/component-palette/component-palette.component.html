<!-- src/app/features/visual-builder/components/component-palette/component-palette.component.html -->

<div class="component-palette">
  
  <!-- ============================================ -->
  <!-- BARRE DE RECHERCHE -->
  <!-- ============================================ -->
  <div class="palette-search">
    <div class="search-input-wrapper">
      <span class="search-icon">üîç</span>
      <input
        type="text"
        class="search-input"
        placeholder="Rechercher un composant..."
        [value]="searchTerm()"
        (input)="onSearchChange($any($event.target).value)"
      />
      @if (searchTerm()) {
        <button
          class="search-clear"
          (click)="clearSearch()"
          title="Effacer">
          ‚úï
        </button>
      }
    </div>
    
    @if (searchTerm()) {
      <div class="search-results">
        <span class="results-count">{{ totalFilteredCount() }} r√©sultat(s)</span>
      </div>
    }
  </div>
  
  <!-- ============================================ -->
  <!-- FILTRES PAR CAT√âGORIE -->
  <!-- ============================================ -->
  <div class="palette-filters">
    <button
      class="filter-btn"
      [class.active]="selectedCategory() === null"
      (click)="selectCategory(null)">
      Tous
    </button>
    
    @for (category of categories; track category.key) {
      <button
        class="filter-btn"
        [class.active]="selectedCategory() === category.key"
        (click)="selectCategory(category.key)"
        [title]="category.label">
        <span class="filter-icon">{{ category.icon }}</span>
        <span class="filter-label">{{ category.label }}</span>
        <span class="filter-count">({{ getCategoryCount(category.key) }})</span>
      </button>
    }
  </div>
  
  <!-- ============================================ -->
  <!-- LISTE DES COMPOSANTS PAR CAT√âGORIE -->
  <!-- ============================================ -->
  <div class="palette-content">
    
    @if (selectedCategory()) {
      <!-- Mode filtr√© : une seule cat√©gorie -->
      <div class="palette-category">
        <div class="components-grid">
          @for (component of filteredComponents(); track component.type) {
            <div
              class="component-item"
              draggable="true"
              (click)="onComponentClick(component)"
              (dragstart)="onDragStart($event, component)"
              (dragend)="onDragEnd($event)"
              [title]="component.description">
              
              <div class="component-icon">{{ component.icon }}</div>
              <div class="component-name">{{ component.displayName }}</div>
              
            </div>
          }
        </div>
        
        @if (filteredComponents().length === 0) {
          <div class="empty-state">
            <p>Aucun composant trouv√©</p>
          </div>
        }
      </div>
      
    } @else {
      <!-- Mode normal : toutes les cat√©gories -->
      @for (category of categories; track category.key) {
        @if (componentsByCategory()[category.key]!.length > 0) {
          <div class="palette-category">
            
            <!-- En-t√™te de cat√©gorie -->
            <div
              class="category-header"
              (click)="toggleCategory(category.key)">
              
              <div class="category-info">
                <span class="category-icon">{{ category.icon }}</span>
                <h3 class="category-title">{{ category.label }}</h3>
                <span class="category-count">{{ getCategoryCount(category.key) }}</span>
              </div>
              
              <button class="category-toggle">
                <span [class.expanded]="isCategoryExpanded(category.key)">‚ñº</span>
              </button>
              
            </div>
            
            <!-- Composants de la cat√©gorie -->
            @if (isCategoryExpanded(category.key)) {
              <div class="components-grid">
                @for (component of componentsByCategory()[category.key]; track component.type) {
                  <div
                    class="component-item"
                    draggable="true"
                    (click)="onComponentClick(component)"
                    (dragstart)="onDragStart($event, component)"
                    (dragend)="onDragEnd($event)"
                    [title]="component.description">
                    
                    <div class="component-icon">{{ component.icon }}</div>
                    <div class="component-name">{{ component.displayName }}</div>
                    
                  </div>
                }
              </div>
            }
            
          </div>
        }
      }
    }
    
    <!-- √âtat vide global -->
    @if (totalFilteredCount() === 0 && searchTerm()) {
      <div class="palette-empty">
        <div class="empty-icon">üîç</div>
        <h3 class="empty-title">Aucun r√©sultat</h3>
        <p class="empty-text">
          Aucun composant ne correspond √† "{{ searchTerm() }}"
        </p>
        <button class="empty-action" (click)="clearSearch()">
          Effacer la recherche
        </button>
      </div>
    }
    
  </div>
  
  <!-- ============================================ -->
  <!-- AIDE -->
  <!-- ============================================ -->
  <div class="palette-help">
    <div class="help-icon">üí°</div>
    <p class="help-text">
      Cliquez ou glissez-d√©posez un composant sur le canvas pour l'ajouter
    </p>
  </div>
  
</div>