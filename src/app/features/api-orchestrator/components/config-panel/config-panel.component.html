<!-- src/app/features/api-orchestrator/components/config-panel/config-panel.component.html -->

<aside class="config-panel">
  <!-- Si aucun bloc sÃ©lectionnÃ© -->
  <div *ngIf="!selectedBlock()" class="empty-state">
    <span class="empty-icon">ðŸ‘†</span>
    <p>SÃ©lectionnez un bloc pour configurer</p>
  </div>

  <!-- Si bloc sÃ©lectionnÃ© -->
  <div *ngIf="selectedBlock() as block" class="config-content">
    <!-- Header -->
    <div class="config-header">
      <h3>{{ block.name }}</h3>
      <span class="config-type">{{ getBlockType(block.definitionId) }}</span>
    </div>

    <!-- Tabs de configuration -->
    <div class="config-tabs">
      <button
        class="tab"
        [class.active]="activeTab === 'inputs'"
        (click)="activeTab = 'inputs'"
      >
        EntrÃ©es
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'config'"
        (click)="activeTab = 'config'"
      >
        Configuration
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'info'"
        (click)="activeTab = 'info'"
      >
        Info
      </button>
    </div>

    <!-- Tab: Inputs (EntrÃ©es configurables) -->
    <div *ngIf="activeTab === 'inputs'" class="tab-content">
      <div class="form-group" *ngFor="let input of getBlockInputs()">
        <label>{{ input.name }}</label>
        <input
          type="text"
          class="form-input"
          [value]="getConfigValue(input.id)"
          (change)="onConfigChange(input.id, $event)"
          [placeholder]="input.description"
        />
        <span class="form-hint" *ngIf="input.required">* Requis</span>
      </div>
    </div>

    <!-- Tab: Config (Configuration spÃ©cifique) -->
    <div *ngIf="activeTab === 'config'" class="tab-content">
      <div class="form-group">
        <label>Nom du bloc</label>
        <input
          type="text"
          class="form-input"
          [value]="block.name"
          (change)="onNameChange($event)"
        />
      </div>

      <div class="form-group" *ngIf="block.type === 'api-call'">
        <label>URL</label>
        <input
          type="text"
          class="form-input"
          [value]="block.config['url'] || ''"
          (change)="onConfigChange('url', $event)"
          placeholder="https://api.example.com/..."
        />
      </div>

      <div class="form-group" *ngIf="block.type === 'api-call'">
        <label>MÃ©thode HTTP</label>
        <select
          class="form-input"
          (change)="onConfigChange('method', $event)"
        >
          <option value="GET" [selected]="block.config['method'] === 'GET'">GET</option>
          <option value="POST" [selected]="block.config['method'] === 'POST'">POST</option>
          <option value="PUT" [selected]="block.config['method'] === 'PUT'">PUT</option>
          <option value="DELETE" [selected]="block.config['method'] === 'DELETE'">DELETE</option>
        </select>
      </div>

      <div class="form-group" *ngIf="block.type === 'condition'">
        <label>Condition</label>
        <textarea
          class="form-input form-textarea"
          [value]="block.config['condition'] || ''"
          (change)="onConfigChange('condition', $event)"
          placeholder="Entrez une expression JavaScript"
        ></textarea>
      </div>

      <div class="form-group" *ngIf="block.type === 'transform'">
        <label>Transformation (JSON)</label>
        <textarea
          class="form-input form-textarea"
          [value]="block.config['transformation'] || '{}'"
          (change)="onConfigChange('transformation', $event)"
          placeholder="{}"
        ></textarea>
      </div>
    </div>

    <!-- Tab: Info (Informations du bloc) -->
    <div *ngIf="activeTab === 'info'" class="tab-content">
      <div class="info-section">
        <h4>Description</h4>
        <p>{{ getBlockDefinition()?.description }}</p>
      </div>

      <div class="info-section">
        <h4>Ports d'entrÃ©e</h4>
        <ul class="port-list">
          <li *ngFor="let input of getBlockDefinition()?.inputs">
            <strong>{{ input.name }}</strong>
            <span class="port-type">{{ input.dataType }}</span>
            <span *ngIf="input.required" class="port-required">requis</span>
          </li>
        </ul>
      </div>

      <div class="info-section">
        <h4>Ports de sortie</h4>
        <ul class="port-list">
          <li *ngFor="let output of getBlockDefinition()?.outputs">
            <strong>{{ output.name }}</strong>
            <span class="port-type">{{ output.dataType }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</aside>